/*
 * GitPHP
 * 
 * @author Christopher Han <xiphux@gmail.com>
 * @copyright Copyright (c) 2012 Christopher Han
 * @package GitPHP
 * @subpackage Javascript
 */
define("modules/geturl",["module"],function(a){return a.config().baseurl});define("modules/getproject",["module"],function(a){return a.config().project||null});
define("modules/commitactivitygraph",["modules/geturl","modules/getproject","d3"],function(a,e){var f=null,d=null,k=null,c=null,b=null,i=null,g=null,p=null,j=null,h=null,m=null,n=null,l=null,o=null,r=null,q=function(a){h=o==j.length?j.slice(l):j.slice(l,o);c.domain([h[0].x,h[h.length-1].x]);g.transition().duration(500).select(".xaxis").call(m);var e=p.selectAll("rect").data(h,function(a){return a.x.getTime()});e.enter().append("rect").attr("class","bar").attr("fill","steelblue").attr("width",20).style("opacity",
0).attr("x",function(b){return a==1?c(b.x)-60.5:a==2?c(b.x)+59.5:c(b.x)-0.5}).attr("height",0).on("mouseover",function(a){var b=d3.time.format("%B %Y")(a.x),a=a.y+" commits";d.transition().duration(500).style("opacity",1).text(b);k.transition().duration(500).style("opacity",1).text(a);f.transition().duration(500).style("opacity",1)}).on("mouseout",function(){d.transition().duration(500).style("opacity",0);k.transition().duration(500).style("opacity",0);f.transition().duration(500).style("opacity",
0)});e.transition().duration(500).attr("x",function(a){return c(a.x)-0.5}).attr("height",function(a){return 500-b(a.y)}).style("opacity",1);e.exit().transition().duration(500).attr("height",0).attr("x",function(a){return c(a.x)-0.5}).style("opacity",0).remove()};return{init:function(h){c=d3.time.scale().range([10,950]);b=d3.scale.linear().range([500,0]);r=d3.select(h).append("div").style("text-align","center").style("padding-top","10px").style("width","960px").style("height","20px").style("opacity",
0);g=d3.select(h).append("svg").attr("width",1020).attr("height",560);p=g.append("g").attr("transform","translate(20,520)scale(1,-1)");h=g.append("g");f=h.append("rect").attr("width",150).attr("height",70).attr("x",405).attr("y",95).attr("stroke","#EDECE6").attr("stroke-width",1).attr("fill","white").style("opacity",0);d=h.append("text").attr("font-size","16").attr("text-anchor","middle").attr("dx",480).attr("dy",125).text("Loading commits...");k=h.append("text").attr("font-size","16").attr("text-anchor",
"middle").attr("dx",480).attr("dy",145).style("opacity",0);d3.json(a+"?p="+e+"&a=graphdata&g=commitactivity",function(a){a.forEach(function(a){a.CommitEpoch=new Date(a.CommitEpoch*1E3)});var e=d3.extent(a,function(a){return a.CommitEpoch});e[1].setMonth(e[1].getMonth()+2);d3.time.months(e[0],e[1]);i=d3.layout.histogram().value(function(a){return a.CommitEpoch}).range(e).bins(d3.time.months(e[0],e[1]));j=i(a);l=j.length-15;o=j.length;b.domain([0,d3.max(j,function(a){return a.y})]);d.transition().duration(500).style("opacity",
0);m=d3.svg.axis().scale(c).ticks(d3.time.months,1).orient("bottom");g.append("g").attr("class","xaxis").attr("transform","translate(30,520)");n=d3.svg.axis().scale(b).ticks(10).orient("right");g.append("g").attr("class","yaxis").attr("transform","translate(990,20)").call(n);r.transition().duration(500).text("<- Use the arrow keys to navigate ->").style("opacity",1);q();d3.select(window).on("keydown",function(){d3.event.keyCode==37?l>0&&(o--,l--,q(1)):d3.event.keyCode==39&&o<j.length&&(o++,l++,q(2))})})}}});
define("modules/lang",["jquery"],function(){return function(a){a.find("select").change(function(){a.find("form").submit()});a.find('input[type="submit"]').remove()}});define("modules/snapshotformats",["module"],function(a){return a.config().formats||null});define("modules/resources",["module"],function(a){return a.config().resources});
define("modules/tooltip.snapshot",["jquery","modules/snapshotformats","modules/resources"],function(a,e,f){function d(a){var c="<div>"+f.Snapshot+": ",b=!0,d=a.indexOf("/snapshot")!=-1,g;for(g in e)e.hasOwnProperty(g)&&(b||(c+=" | "),d?(b=a.replace("/snapshot","/"+g),c+='<a href="'+b+'">'+e[g]+"</a>"):c+='<a href="'+a+"&fmt="+g+'">'+e[g]+"</a>",b=!1);c+="</div>";return c}return function(e){e&&e.size()>0&&require(["qtip"],function(){e.each(function(){var e=a(this),b=e.attr("href"),b={content:{text:d(b)},
show:{event:"click"},hide:{fixed:!0,delay:150},style:{classes:"ui-tooltip-gitphp ui-tooltip-light ui-tooltip-shadow"},position:{viewport:a(window)}};e.qtip(b);e.click(function(){return!1})})})}});
define("modules/tooltip.commit",["jquery","modules/geturl","modules/getproject","modules/resources"],function(a,e,f,d){return function(k){k&&k.size()>0&&require(["qtip"],function(){k.each(function(){var c=a(this),b;(b=c.attr("href").match(/h=([0-9a-fA-F]{4,40}|HEAD)/))||(b=c.attr("href").match(/\/commits\/([0-9a-fA-F]{4,40}|HEAD)/));if(b=b?b[1]:null)b={content:{text:'<img src="'+e+'images/tooltip-loader.gif" alt="'+d.Loading+'" />',ajax:{url:e,data:{p:f,a:"commit",o:"jstip",h:b},type:"GET"}},style:{classes:"ui-tooltip-gitphp ui-tooltip-light ui-tooltip-shadow"},
position:{viewport:a(window)}},c.qtip(b)})})}});
define("modules/tooltip.tag",["jquery","modules/geturl","modules/getproject","modules/resources"],function(a,e,f,d){return function(k){k&&k.size()>0&&require(["qtip"],function(){k.each(function(){var c=a(this),b;(b=c.attr("href").match(/t=([^&]+)/))||(b=c.attr("href").match(/\/tags\/([^\/\?]+)/));if(b=b?b[1]:null)b={content:{text:'<img src="'+e+'images/tooltip-loader.gif" alt="'+d.Loading+'" />',ajax:{url:e,data:{p:f,a:"tag",o:"jstip",t:b},type:"GET"}},style:{classes:"ui-tooltip-gitphp ui-tooltip-light ui-tooltip-shadow"},
position:{viewport:a(window)}},c.qtip(b)})})}});
define("modules/loginpopup",["jquery","modules/geturl","modules/resources","qtip"],function(a,e,f){return function(d){a(d).qtip({content:{text:function(){var d=a(document.createElement("div")),c=a(document.createElement("div")).addClass("loginError").addClass("error").css("padding-top","0px"),b=a(document.createElement("div")).addClass("loginForm"),i=a(document.createElement("form"));d.append(b);b.append(i);i.append(c);var b=a(document.createElement("div")).addClass("field"),c=a(document.createElement("label")).attr("for",
"username").text(f.UsernameLabel),g=a(document.createElement("input")).attr("type","text").attr("name","username").attr("id","username");b.append(c);b.append(g);i.append(b);b=a(document.createElement("div")).addClass("field");c=a(document.createElement("label")).attr("for","password").text(f.PasswordLabel);g=a(document.createElement("input")).attr("type","password").attr("name","password").attr("id","password");b.append(c);b.append(g);i.append(b);b=a(document.createElement("div")).addClass("submit");
c=a(document.createElement("input")).attr("type","submit").attr("value",f.Login);b.append(c);i.append(b);i.bind("submit",function(){var b=a("input[name=username]",this).val(),c=a("input[name=password]",this).val(),d=a(".loginError",this);if(!b)return d.text(f.UsernameIsRequired),!1;if(!c)return d.text(f.PasswordIsRequired),!1;d.text("");var g=a("input",this);a.ajax({url:e+"?a=login&o=js",data:{a:"login",o:"js",username:b,password:c},type:"post",dataType:"json",success:function(a){a?a.success===!0?
window.location.reload():a.message?d.text(a.message):d.text(f.AnErrorOccurredWhileLoggingIn):d.text(f.AnErrorOccurredWhileLoggingIn)},error:function(){d.text(f.AnErrorOccurredWhileLoggingIn)},beforeSend:function(){g.attr("disabled","disabled")},complete:function(){g.removeAttr("disabled")}});return!1});return d},title:{text:f.LoginTitle,button:!0}},position:{my:"center",at:"center",target:a(window)},show:{event:"click",modal:{on:!0}},hide:{event:!1},style:{classes:"ui-tooltip-light ui-tooltip-shadow"},
events:{visible:function(){a("input[name=username]",this).focus()}}});a(d).click(function(){return!1})}});
window.Modernizr=function(a,e){function f(){d.input=function(d){for(var c=0,f=d.length;c<f;c++)g[d[c]]=!!(d[c]in b);if(g.list)g.list=!(!e.createElement("datalist")||!a.HTMLDataListElement);return g}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "))}var d={},k=e.documentElement,c=e.createElement("modernizr"),c=c.style,b=e.createElement("input"),i={},g={},p=[],j=p.slice,h,m={}.hasOwnProperty,n;n=typeof m!=="undefined"&&typeof m.call!=="undefined"?function(a,
b){return m.call(a,b)}:function(a,b){return b in a&&typeof a.constructor.prototype[b]==="undefined"};if(!Function.prototype.bind)Function.prototype.bind=function(a){var b=this;if(typeof b!="function")throw new TypeError;var e=j.call(arguments,1),d=function(){if(this instanceof d){var c=function(){};c.prototype=b.prototype;var c=new c,f=b.apply(c,e.concat(j.call(arguments)));return Object(f)===f?f:c}else return b.apply(a,e.concat(j.call(arguments)))};return d};for(var l in i)n(i,l)&&(h=l.toLowerCase(),
d[h]=i[l](),p.push((d[h]?"":"no-")+h));d.input||f();d.addTest=function(a,b){if(typeof a=="object")for(var c in a)n(a,c)&&d.addTest(c,a[c]);else{a=a.toLowerCase();if(d[a]!==void 0)return d;b=typeof b=="function"?b():b;typeof enableClasses!=="undefined"&&enableClasses&&(k.className+=" "+(b?"":"no-")+a);d[a]=b}return d};c.cssText="";c=b=null;d._version="2.6.2";d.testStyles=function(a,b,c,d){var f,g,h=e.createElement("div"),i=e.body,j=i||e.createElement("body");if(parseInt(c,10))for(;c--;)f=e.createElement("div"),
f.id=d?d[c]:"modernizr"+(c+1),h.appendChild(f);c=['&#173;<style id="smodernizr">',a,"</style>"].join("");h.id="modernizr";(i?h:j).innerHTML+=c;j.appendChild(h);if(!i)j.style.background="",j.style.overflow="hidden",g=k.style.overflow,k.style.overflow="hidden",k.appendChild(j);a=b(h,a);i?h.parentNode.removeChild(h):(j.parentNode.removeChild(j),k.style.overflow=g);return!!a};return d}(this,this.document);define("modernizr",function(){});
define("common","jquery,module,modules/getproject,modules/lang,modules/tooltip.snapshot,modules/tooltip.commit,modules/tooltip.tag,modules/loginpopup,modernizr".split(","),function(a,e,f,d,k,c,b,i){a(function(){d(a("div.lang_select"));k(a("a.snapshotTip"));f&&(c(a("a.commitTip")),b(a("a.tagTip")));Modernizr.input.autofocus||a("input[autofocus]").filter(":first").focus();i("a.loginLink")});e.config().debug&&require(["modules/debug"])});
define("commitactivity",["jquery","modules/commitactivitygraph","common"],function(a,e){a(function(){e.init("div#graph")})});